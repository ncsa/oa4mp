#! /usr/bin/env -S qdl-run

/*
   Tests a client with no configuration. This is as basic as it gets.

*/
path := os_env('NCSA_DEV_INPUT')+'/oa4mp/server-test/src/main/resources/flow-tests';
if[path∉script_path()][script_path(path ~ script_path());];
debugger(1);
params. ≔ {'sub':'jeff'};
clc#init('/home/ncsa/dev/csd/config/auto-test/clients.ini', 'auto-test:basic');

tokens. := clc#rfc7523(params.);
claims. := clc#claims();

⊨ tokens.'access_token'.'lifetime' == 1009000 : 'wrong access token lifetime';
⊨ tokens.'refresh_token'.'lifetime' == 950400000 : 'wrong refresh token lifetime';
⊨ claims().'aud' == cfg.'id' : 'wrong audience';
say('Test no config: ok');