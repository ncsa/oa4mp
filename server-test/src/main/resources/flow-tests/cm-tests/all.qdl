#! /usr/bin/env -S qdl-run
/*
   The main test suite for client management.
   See readme.txt for details.

*/
path := '/home/ncsa/dev/ncsa-git/oa4mp/server-test/src/main/resources/flow-tests/cm-tests/';
script_path(path ~ script_path());
test.:= path + ['cm-basic.qdl',
                'cm-private-key.qdl',
                'cm-extra.qdl',
                'cm-public.qdl',
                'cm-public-update.qdl',
                'cm-update.qdl',
                'anon-public.qdl',
                'anon-basic.qdl',
                'anon-cfg.qdl',
                'anon-extra.qdl',
                'cm-cleanup.qdl'];
say('Running all tests. ');
logger(1);
default_suite:='cm_local';
suite := 0<size(args())?args(0):default_suite;
say('logging to ' + info().'boot'.'log_file');
counter.'pass' := 0;
counter.'fail' := 0;
while[xâˆˆtest.][
try[
  script_load(x,suite);
  counter.'pass' += 1;
  ]catch[
     logger(4,say('error running script ' + x));
     logger(4,say('error message:' + error_message));
     //say('error running script ' + x);
     //say('error message:' + error_message);
    counter.'fail' += 1;
  ];
];

logger(2,say(counter.'pass' + ' passed'));
logger(2,say(counter.'fail' + ' failed'));
logger(2,say('total tests run = ' + (counter.'pass' + counter.'fail')));
