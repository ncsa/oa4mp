#! /usr/bin/env -S qdl-run

/*
   Tests the client with no configuration

*/
path := '/home/ncsa/dev/ncsa-git/oa4mp/oa4mp-server-test-oauth2/src/main/resources/flow-tests';
if[path∉script_path()][script_path(path ~ script_path());];
save_path := '/home/ncsa/dev/flow-test';
ids. := script_load(path + '/test/ids.qdl');

 say('starting...');
 
while[
  x ∈ ids.
  ][
   try[
       say('reading ' + x);
       clc#read(save_path + '/' + encode(x, 32) + '.xml');
       tokens. := clc#refresh();
       tokens. := clc#exchange();
       tokens. := clc#exchange('-rt');
       say('   check ok');
     ]catch[
       say('check failed for ' + x + ': ' + error_message);
  ];
];

